<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
      Earnings Management Simulator | Financial Reporting & Analysis
    </title>
    <style>
      :root {
        --blue-50: #eff6ff;
        --blue-100: #dbeafe;
        --blue-600: #2563eb;
        --blue-700: #1d4ed8;
        --blue-800: #1e40af;
        --gray-50: #f9fafb;
        --gray-100: #f3f4f6;
        --gray-200: #e5e7eb;
        --gray-300: #d1d5db;
        --gray-400: #9ca3af;
        --gray-500: #6b7280;
        --gray-600: #4b5563;
        --gray-700: #374151;
        --green-50: #f0fdf4;
        --green-600: #16a34a;
        --red-50: #fef2f2;
        --red-100: #fee2e2;
        --red-600: #dc2626;
        --red-700: #b91c1c;
        --yellow-50: #fefce8;
        --yellow-100: #fef9c3;
        --yellow-200: #fef08a;
        --yellow-600: #ca8a04;
        --purple-600: #9333ea;
        --orange-500: #f97316;
      }

      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          Helvetica, Arial, sans-serif;
        line-height: 1.5;
        color: var(--gray-700);
        background-color: var(--gray-100);
      }

      nav {
        background-color: var(--blue-800);
        color: white;
        padding: 1rem;
      }

      .container {
        width: 100%;
        max-width: 1200px;
        margin: 0 auto;
        padding: 1.5rem;
      }

      .nav-container {
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .nav-container h1 {
        font-size: 1.25rem;
        font-weight: 700;
      }

      .nav-container a {
        color: white;
        text-decoration: none;
      }

      .nav-container a:hover {
        text-decoration: underline;
      }

      .intro-panel {
        background-color: var(--blue-50);
        padding: 1rem;
        border-radius: 0.5rem;
        margin-bottom: 1.5rem;
      }

      .intro-panel h1 {
        font-size: 1.25rem;
        font-weight: 700;
        margin-bottom: 0.5rem;
      }

      .intro-panel p {
        margin-bottom: 1rem;
      }

      .strategy-box {
        background-color: var(--yellow-50);
        border: 1px solid var(--yellow-100);
        border-radius: 0.5rem;
        padding: 0.75rem;
      }

      .strategy-box p {
        font-size: 0.875rem;
        font-weight: 600;
      }

      .strategy-box ul {
        list-style-type: disc;
        margin-left: 1.5rem;
        font-size: 0.875rem;
      }

      .grid {
        display: grid;
        grid-template-columns: 1fr;
        gap: 1.5rem;
        margin-bottom: 2rem;
      }

      @media (min-width: 768px) {
        .grid {
          grid-template-columns: 1fr 1fr;
        }
      }

      .panel {
        background-color: white;
        border-radius: 0.5rem;
        padding: 1rem;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      }

      h2 {
        font-size: 1.125rem;
        font-weight: 700;
        margin-bottom: 1rem;
      }

      h3 {
        font-size: 1rem;
        font-weight: 700;
        margin-bottom: 0.5rem;
      }

      h4 {
        font-size: 0.875rem;
        font-weight: 700;
        margin-bottom: 0.5rem;
      }

      table {
        width: 100%;
        border-collapse: collapse;
      }

      th {
        background-color: var(--gray-100);
        text-align: left;
        padding: 0.5rem 1rem;
      }

      td {
        padding: 0.5rem 1rem;
        border-top: 1px solid var(--gray-200);
      }

      td.editable {
        padding: 0;
      }

      .input-group {
        display: flex;
        justify-content: flex-end;
        align-items: center;
      }

      .input-group span {
        margin-right: 0.5rem;
      }

      .input-group input {
        width: 5rem;
        padding: 0.25rem;
        text-align: right;
        border: 1px solid var(--gray-300);
        border-radius: 0.25rem;
      }

      .highlight-row {
        background-color: var(--blue-50);
      }

      .text-right {
        text-align: right;
      }

      .text-red {
        color: var(--red-600);
      }

      .text-green {
        color: var(--green-600);
      }

      .progress-container {
        margin-top: 1rem;
        padding: 0.75rem;
        border-radius: 0.25rem;
        background-color: var(--gray-50);
      }

      .progress-container p {
        font-size: 0.875rem;
        font-weight: 600;
        margin-bottom: 0.5rem;
      }

      .progress-bar {
        width: 100%;
        height: 0.625rem;
        background-color: var(--gray-200);
        border-radius: 9999px;
      }

      .progress-fill {
        height: 100%;
        border-radius: 9999px;
        transition: width 0.3s ease;
      }

      .progress-fill.red {
        background-color: var(--red-600);
      }

      .progress-fill.green {
        background-color: var(--green-600);
      }

      .strategy-section {
        margin-bottom: 1.5rem;
      }

      .radio-group {
        display: flex;
        gap: 1rem;
        margin-bottom: 1rem;
      }

      .radio-option {
        display: flex;
        align-items: center;
      }

      .radio-option input {
        margin-right: 0.5rem;
      }

      .strategy-explanation {
        background-color: var(--gray-50);
        border-radius: 0.25rem;
        padding: 0.75rem;
        font-size: 0.875rem;
        margin-bottom: 1.5rem;
      }

      .slider-container {
        margin-bottom: 1rem;
      }

      .slider-container label {
        display: block;
        font-size: 0.875rem;
        font-weight: 500;
        margin-bottom: 0.5rem;
      }

      .slider-value {
        margin-left: 0.5rem;
        color: var(--gray-500);
      }

      input[type="range"] {
        width: 100%;
      }

      .button-group {
        display: flex;
        gap: 1rem;
      }

      button {
        padding: 0.5rem 1rem;
        border-radius: 0.25rem;
        font-weight: 500;
        cursor: pointer;
        transition: background-color 0.2s;
        border: none;
      }

      button.primary {
        background-color: var(--blue-600);
        color: white;
      }

      button.primary:hover:not(:disabled) {
        background-color: var(--blue-700);
      }

      button.secondary {
        background-color: var(--gray-200);
        color: var(--gray-700);
      }

      button.secondary:hover {
        background-color: var(--gray-300);
      }

      button:disabled {
        background-color: var(--gray-300);
        color: var(--gray-500);
        cursor: not-allowed;
      }

      .error-message {
        margin-top: 0.75rem;
        font-size: 0.875rem;
        color: var(--red-600);
      }

      .hidden {
        display: none;
      }

      .chart-container {
        height: 16rem;
        margin-bottom: 1rem;
        position: relative;
        border: 1px solid var(--gray-200);
        border-radius: 0.25rem;
        padding: 0.5rem;
        overflow: hidden;
      }

      .chart-y-axis {
        position: absolute;
        height: 100%;
        width: 50px;
        left: 0;
        top: 0;
        border-right: 1px solid var(--gray-200);
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        padding: 0.5rem 0;
      }

      .chart-y-axis span {
        font-size: 0.75rem;
        color: var(--gray-500);
        text-align: right;
        padding-right: 0.5rem;
      }

      .chart-x-axis {
        position: absolute;
        width: calc(100% - 50px);
        height: 20px;
        bottom: 0;
        right: 0;
        border-top: 1px solid var(--gray-200);
        display: flex;
        justify-content: space-around;
      }

      .chart-x-axis span {
        font-size: 0.75rem;
        color: var(--gray-500);
        transform: translateY(50%);
      }

      .chart-area {
        position: absolute;
        top: 0.5rem;
        left: 50px;
        right: 0.5rem;
        bottom: 20px;
      }

      .chart-line {
        position: absolute;
        stroke-width: 2px;
        fill: none;
      }

      .chart-point {
        position: absolute;
        width: 6px;
        height: 6px;
        border-radius: 50%;
        transform: translate(-3px, -3px);
      }

      .chart-zero-line {
        position: absolute;
        width: 100%;
        border-top: 1px dashed green;
      }

      .chart-legend {
        display: flex;
        flex-wrap: wrap;
        gap: 1rem;
        margin-bottom: 1rem;
      }

      .legend-item {
        display: flex;
        align-items: center;
        font-size: 0.75rem;
      }

      .legend-color {
        width: 12px;
        height: 12px;
        border-radius: 2px;
        margin-right: 0.25rem;
      }

      .analysis-section {
        padding: 1.5rem;
        background-color: white;
        border-radius: 0.5rem;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        margin-bottom: 2rem;
      }

      .analysis-text {
        white-space: pre-line;
        margin-bottom: 1.5rem;
      }

      .key-learnings {
        background-color: var(--yellow-50);
        border: 1px solid var(--yellow-200);
        border-radius: 0.25rem;
        padding: 1rem;
      }

      .key-learnings ul {
        list-style-type: disc;
        margin-left: 1.5rem;
      }
    </style>
  </head>
  <body>
    <nav>
      <div class="nav-container container">
        <h1>Financial Reporting & Analysis</h1>
        <a href="../">← Back to Components</a>
      </div>
    </nav>

    <div class="container">
      <div class="intro-panel">
        <h1>Earnings Management Simulator</h1>
        <p>
          You're the CFO of a technology company facing pressure to meet analyst
          expectations. Your company is projected to report a loss of €50M, but
          analysts expect at least breakeven (€0 profit). You need to find ways
          to improve the reported earnings without affecting revenue or cost of
          revenue.
        </p>
        <div class="strategy-box">
          <p>You have two main strategies:</p>
          <ul>
            <li>
              <strong>Accrual Earnings Management:</strong> Manipulate
              accounting estimates and timing of recognition (no real business
              changes)
            </li>
            <li>
              <strong>Real Earnings Management:</strong> Make actual business
              decisions to cut costs (real operational changes)
            </li>
          </ul>
        </div>
      </div>

      <div class="grid">
        <!-- Income Statement Panel -->
        <div class="panel">
          <h2>Income Statement (in €M)</h2>
          <div style="overflow-x: auto">
            <table>
              <thead>
                <tr>
                  <th>Line Item</th>
                  <th class="text-right">Original 2025</th>
                  <th class="text-right">Revised 2025</th>
                  <th class="text-right">Adjustment</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>Revenue</td>
                  <td class="text-right">€950</td>
                  <td class="text-right">€950</td>
                  <td class="text-right">€0</td>
                </tr>
                <tr>
                  <td>Cost of Revenue</td>
                  <td class="text-right">(€270)</td>
                  <td class="text-right">(€270)</td>
                  <td class="text-right">€0</td>
                </tr>
                <tr class="highlight-row">
                  <td>Research & Development</td>
                  <td class="text-right">(€300)</td>
                  <td class="editable">
                    <div class="input-group">
                      <span>€</span>
                      <input
                        type="number"
                        id="rd-input"
                        min="0"
                        max="300"
                        value="300"
                      />
                    </div>
                  </td>
                  <td class="text-right" id="rd-adjustment">€0</td>
                </tr>
                <tr class="highlight-row">
                  <td>Sales & Marketing</td>
                  <td class="text-right">(€320)</td>
                  <td class="editable">
                    <div class="input-group">
                      <span>€</span>
                      <input
                        type="number"
                        id="sm-input"
                        min="0"
                        max="320"
                        value="320"
                      />
                    </div>
                  </td>
                  <td class="text-right" id="sm-adjustment">€0</td>
                </tr>
                <tr class="highlight-row">
                  <td>General & Administrative</td>
                  <td class="text-right">(€110)</td>
                  <td class="editable">
                    <div class="input-group">
                      <span>€</span>
                      <input
                        type="number"
                        id="ga-input"
                        min="0"
                        max="110"
                        value="110"
                      />
                    </div>
                  </td>
                  <td class="text-right" id="ga-adjustment">€0</td>
                </tr>
                <tr style="font-weight: bold">
                  <td>Operating Profit</td>
                  <td class="text-right text-red" id="original-profit">
                    (€50)
                  </td>
                  <td class="text-right" id="current-profit">(€50)</td>
                  <td class="text-right" id="profit-adjustment">€0</td>
                </tr>
              </tbody>
            </table>
          </div>

          <div class="progress-container">
            <p>
              Target: €0 or better | Current:
              <span id="current-profit-display">(€50)</span> | Needed:
              <span id="amount-needed">€50</span>
            </p>
            <div class="progress-bar">
              <div
                class="progress-fill red"
                id="progress-bar"
                style="width: 0%"
              ></div>
            </div>
          </div>
        </div>

        <!-- Strategy Panel -->
        <div class="panel">
          <h2>Management Strategy</h2>

          <div class="strategy-section">
            <label class="block text-sm font-medium mb-2"
              >Choose your approach:</label
            >
            <div class="radio-group">
              <div class="radio-option">
                <input
                  type="radio"
                  id="accrual-radio"
                  name="management-strategy"
                  value="accrual"
                  checked
                />
                <label for="accrual-radio">Accrual Management</label>
              </div>

              <div class="radio-option">
                <input
                  type="radio"
                  id="real-radio"
                  name="management-strategy"
                  value="real"
                />
                <label for="real-radio">Real Management</label>
              </div>
            </div>
          </div>

          <div class="strategy-section">
            <h3>Strategy Explanation:</h3>
            <div class="strategy-explanation" id="strategy-explanation">
              <p style="margin-bottom: 0.5rem">
                <strong>Accrual Earnings Management</strong> involves
                manipulating the timing of revenue and expense recognition
                without changing real business operations:
              </p>
              <ul style="margin-left: 1.5rem; margin-bottom: 0.5rem">
                <li>Aggressively delaying R&D expense recognition</li>
                <li>Capitalizing marketing costs that should be expensed</li>
                <li>Extending amortization periods</li>
                <li>Recording unearned revenue earlier</li>
              </ul>
              <p>
                <strong>Consequences:</strong> These accruals typically reverse
                in future periods, creating pressure to continue or increase the
                practices.
              </p>
            </div>
          </div>

          <div class="slider-container">
            <label>
              Simulation Years:
              <span class="slider-value" id="years-value">5</span>
            </label>
            <input type="range" id="years-slider" min="1" max="10" value="5" />
          </div>

          <div class="button-group">
            <button id="run-btn" class="primary" disabled>
              Run Simulation
            </button>
            <button id="reset-btn" class="secondary">Reset</button>
          </div>

          <p class="error-message" id="error-message">
            You need to meet the profit target of €0 or better to run the
            simulation.
          </p>
        </div>
      </div>

      <!-- Simulation Results Section -->
      <div id="results-section" class="hidden">
        <h2>Simulation Results</h2>

        <div class="grid">
          <!-- Profit Trend -->
          <div class="panel">
            <h3>Profit Trend (€M)</h3>
            <div class="chart-container">
              <div class="chart-y-axis" id="profit-y-axis">
                <!-- Y-axis labels added by JavaScript -->
              </div>
              <div class="chart-x-axis" id="profit-x-axis">
                <!-- X-axis labels added by JavaScript -->
              </div>
              <div class="chart-area" id="profit-chart-area">
                <!-- Chart elements added by JavaScript -->
              </div>
            </div>
          </div>

          <!-- Business Metrics -->
          <div class="panel">
            <h3>Business Metrics</h3>
            <div class="chart-container">
              <div class="chart-y-axis" id="metrics-y-axis">
                <!-- Y-axis labels added by JavaScript -->
              </div>
              <div class="chart-x-axis" id="metrics-x-axis">
                <!-- X-axis labels added by JavaScript -->
              </div>
              <div class="chart-area" id="metrics-chart-area">
                <!-- Chart elements added by JavaScript -->
              </div>
            </div>
            <div class="chart-legend">
              <div class="legend-item">
                <div
                  class="legend-color"
                  style="background-color: #4ade80"
                ></div>
                <span>Market Share</span>
              </div>
              <div class="legend-item">
                <div
                  class="legend-color"
                  style="background-color: #8b5cf6"
                ></div>
                <span>Innovation Index</span>
              </div>
              <div class="legend-item">
                <div
                  class="legend-color"
                  style="background-color: #f59e0b"
                ></div>
                <span>Employee Morale</span>
              </div>
              <div class="legend-item">
                <div
                  class="legend-color"
                  style="background-color: #ef4444"
                ></div>
                <span>Audit Risk</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Explanation and Analysis -->
        <div class="analysis-section">
          <h3>Analysis & Consequences</h3>
          <div class="analysis-text" id="explanation-text">
            <!-- Explanation text added by JavaScript -->
          </div>

          <div class="key-learnings">
            <h4>Key Learnings</h4>
            <ul>
              <li>
                Earnings management may help meet short-term goals but often at
                the expense of long-term performance
              </li>
              <li>
                Accrual-based methods typically "borrow" earnings from future
                periods
              </li>
              <li>
                Real earnings management creates actual business impacts that
                may be difficult to reverse
              </li>
              <li>
                Transparent financial reporting provides the most accurate
                picture for stakeholders and supports sustainable growth
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <script>
      // Initial financial data
      const initialFinancials = {
        revenue: 950,
        costOfRevenue: 270,
        researchAndDevelopment: 300,
        salesAndMarketing: 320,
        generalAndAdmin: 110,
      };

      // Current financial data (will be updated by user)
      let financials = { ...initialFinancials };

      // Simulation settings
      let managementStrategy = "accrual";
      let simulationYears = 5;
      let simulationResults = [];

      // DOM elements
      const rdInput = document.getElementById("rd-input");
      const smInput = document.getElementById("sm-input");
      const gaInput = document.getElementById("ga-input");
      const rdAdjustment = document.getElementById("rd-adjustment");
      const smAdjustment = document.getElementById("sm-adjustment");
      const gaAdjustment = document.getElementById("ga-adjustment");
      const originalProfit = document.getElementById("original-profit");
      const currentProfit = document.getElementById("current-profit");
      const profitAdjustment = document.getElementById("profit-adjustment");
      const currentProfitDisplay = document.getElementById(
        "current-profit-display"
      );
      const amountNeeded = document.getElementById("amount-needed");
      const progressBar = document.getElementById("progress-bar");
      const accrualRadio = document.getElementById("accrual-radio");
      const realRadio = document.getElementById("real-radio");
      const strategyExplanation = document.getElementById(
        "strategy-explanation"
      );
      const yearsSlider = document.getElementById("years-slider");
      const yearsValue = document.getElementById("years-value");
      const runBtn = document.getElementById("run-btn");
      const resetBtn = document.getElementById("reset-btn");
      const errorMessage = document.getElementById("error-message");
      const resultsSection = document.getElementById("results-section");
      const explanationText = document.getElementById("explanation-text");

      // Calculate profit
      function calculateProfit(data) {
        return (
          data.revenue -
          data.costOfRevenue -
          data.researchAndDevelopment -
          data.salesAndMarketing -
          data.generalAndAdmin
        );
      }

      // Format currency
      function formatCurrency(value) {
        return new Intl.NumberFormat("en-US", {
          style: "currency",
          currency: "EUR",
          minimumFractionDigits: 0,
          maximumFractionDigits: 0,
        }).format(value);
      }

      // Update the UI based on current financials
      function updateUI() {
        // Calculate profits
        const origProfit = calculateProfit(initialFinancials);
        const currProfit = calculateProfit(financials);
        const profitDiff = currProfit - origProfit;

        // Update adjustments
        rdAdjustment.textContent = formatCurrency(
          initialFinancials.researchAndDevelopment -
            financials.researchAndDevelopment
        );
        smAdjustment.textContent = formatCurrency(
          initialFinancials.salesAndMarketing - financials.salesAndMarketing
        );
        gaAdjustment.textContent = formatCurrency(
          initialFinancials.generalAndAdmin - financials.generalAndAdmin
        );

        // Update profits
        originalProfit.textContent =
          origProfit >= 0
            ? formatCurrency(origProfit)
            : `(${formatCurrency(Math.abs(origProfit))})`;
        currentProfit.textContent =
          currProfit >= 0
            ? formatCurrency(currProfit)
            : `(${formatCurrency(Math.abs(currProfit))})`;
        profitAdjustment.textContent = formatCurrency(profitDiff);

        // Update current profit and needed amount
        currentProfitDisplay.textContent =
          currProfit >= 0
            ? formatCurrency(currProfit)
            : `(${formatCurrency(Math.abs(currProfit))})`;

        // Only show positive needed amount
        const needed = origProfit < 0 ? Math.abs(origProfit) : 0;
        amountNeeded.textContent = formatCurrency(needed);

        // Calculate total adjustment
        const totalAdjustment =
          initialFinancials.researchAndDevelopment -
          financials.researchAndDevelopment +
          initialFinancials.salesAndMarketing -
          financials.salesAndMarketing +
          initialFinancials.generalAndAdmin -
          financials.generalAndAdmin;

        // Update progress bar
        const progress =
          needed > 0 ? Math.min(100, (totalAdjustment / needed) * 100) : 0;
        progressBar.style.width = `${progress}%`;

        // Change color based on meeting target
        if (currProfit >= 0) {
          currentProfit.className = "text-right text-green";
          progressBar.className = "progress-fill green";
          runBtn.disabled = false;
          errorMessage.classList.add("hidden");
        } else {
          currentProfit.className = "text-right text-red";
          progressBar.className = "progress-fill red";
          runBtn.disabled = true;
          errorMessage.classList.remove("hidden");
        }
      }

      // Update strategy explanation based on selection
      function updateStrategyExplanation() {
        if (managementStrategy === "accrual") {
          strategyExplanation.innerHTML = `
          <p style="margin-bottom: 0.5rem;">
            <strong>Accrual Earnings Management</strong> involves manipulating the timing of revenue and expense recognition without changing real business operations:
          </p>
          <ul style="margin-left: 1.5rem; margin-bottom: 0.5rem;">
            <li>Aggressively delaying R&D expense recognition</li>
            <li>Capitalizing marketing costs that should be expensed</li>
            <li>Extending amortization periods</li>
            <li>Recording unearned revenue earlier</li>
          </ul>
          <p>
            <strong>Consequences:</strong> These accruals typically reverse in future periods, creating pressure to continue or increase the practices.
          </p>
        `;
        } else {
          strategyExplanation.innerHTML = `
          <p style="margin-bottom: 0.5rem;">
            <strong>Real Earnings Management</strong> involves making actual changes to business operations to influence reported earnings:
          </p>
          <ul style="margin-left: 1.5rem; margin-bottom: 0.5rem;">
            <li>Cutting R&D projects or staff</li>
            <li>Reducing advertising and promotional spending</li>
            <li>Delaying or canceling maintenance or training</li>
            <li>Reducing headcount in support functions</li>
          </ul>
          <p>
            <strong>Consequences:</strong> These actions have real and often irreversible impacts on future business performance.
          </p>
        `;
        }
      }

      // Run simulation based on current choices
      function runSimulation() {
        const currProfit = calculateProfit(financials);
        if (currProfit < 0) {
          explanationText.textContent =
            "You need to adjust expenses to achieve a profit of €0 or better before running the simulation.";
          return;
        }

        // Clear previous results
        simulationResults = [];

        // Create base year
        let baseYear = { year: 0, ...financials };
        baseYear.profit = calculateProfit(baseYear);
        baseYear.marketShare = 100;
        baseYear.innovationIndex = 100;
        baseYear.employeeMorale = 100;
        baseYear.auditRisk = 0;

        simulationResults.push(baseYear);

        // Calculate reductions
        const rdReduction =
          initialFinancials.researchAndDevelopment -
          financials.researchAndDevelopment;
        const smReduction =
          initialFinancials.salesAndMarketing - financials.salesAndMarketing;
        const gaReduction =
          initialFinancials.generalAndAdmin - financials.generalAndAdmin;

        // Simulate future years
        for (let year = 1; year <= simulationYears; year++) {
          const prevYear = { ...simulationResults[year - 1] };
          const newYear = {
            year,
            revenue: prevYear.revenue,
            costOfRevenue: prevYear.costOfRevenue,
            researchAndDevelopment: prevYear.researchAndDevelopment,
            salesAndMarketing: prevYear.salesAndMarketing,
            generalAndAdmin: prevYear.generalAndAdmin,
            marketShare: prevYear.marketShare,
            innovationIndex: prevYear.innovationIndex,
            employeeMorale: prevYear.employeeMorale,
            auditRisk: prevYear.auditRisk,
          };

          // Apply consequences based on management strategy
          if (managementStrategy === "real") {
            // Real earnings management - permanent consequences

            // R&D cuts affect innovation and future revenue
            if (rdReduction > 0) {
              const rdImpact =
                rdReduction / initialFinancials.researchAndDevelopment;
              newYear.innovationIndex -= rdImpact * 15 * year; // Compound effect
              // Revenue growth slows due to less innovation
              newYear.revenue = Math.max(
                prevYear.revenue * (1 + 0.05 - rdImpact * 0.03),
                prevYear.revenue
              );
            } else {
              newYear.revenue = prevYear.revenue * 1.05; // Normal growth
            }

            // Sales & Marketing cuts affect market share and future revenue
            if (smReduction > 0) {
              const smImpact =
                smReduction / initialFinancials.salesAndMarketing;
              newYear.marketShare -= smImpact * 10 * year; // Compound effect
              // Revenue directly impacted by market share loss
              newYear.revenue *= newYear.marketShare / prevYear.marketShare;
            }

            // G&A cuts affect employee morale and operational efficiency
            if (gaReduction > 0) {
              const gaImpact = gaReduction / initialFinancials.generalAndAdmin;
              newYear.employeeMorale -= gaImpact * 20;
              // Higher cost of revenue due to inefficiencies
              newYear.costOfRevenue =
                prevYear.costOfRevenue * (1 + gaImpact * 0.05);
            }

            // Update expenses (they stay cut)
            newYear.researchAndDevelopment =
              financials.researchAndDevelopment * (1 + 0.02 * year); // Some natural growth
            newYear.salesAndMarketing =
              financials.salesAndMarketing * (1 + 0.02 * year);
            newYear.generalAndAdmin =
              financials.generalAndAdmin * (1 + 0.02 * year);
          } else {
            // Accrual earnings management - temporary benefit that reverses

            // Revenue grows normally
            newYear.revenue = prevYear.revenue * 1.05;

            // In accrual management, cuts are temporary accounting changes that reverse
            if (year === 1) {
              // First year after - most accruals reverse
              newYear.researchAndDevelopment =
                initialFinancials.researchAndDevelopment * 1.15; // Reversal plus catch-up
              newYear.salesAndMarketing =
                initialFinancials.salesAndMarketing * 1.1;
              newYear.generalAndAdmin = initialFinancials.generalAndAdmin * 1.1;

              // Audit risk increases with accrual management
              newYear.auditRisk =
                (totalAdjustment() /
                  (initialFinancials.researchAndDevelopment +
                    initialFinancials.salesAndMarketing +
                    initialFinancials.generalAndAdmin)) *
                100;
            } else {
              // Expenses normalize in subsequent years
              newYear.researchAndDevelopment =
                initialFinancials.researchAndDevelopment * (1 + 0.03 * year);
              newYear.salesAndMarketing =
                initialFinancials.salesAndMarketing * (1 + 0.03 * year);
              newYear.generalAndAdmin =
                initialFinancials.generalAndAdmin * (1 + 0.03 * year);

              // Audit risk decreases gradually
              newYear.auditRisk = Math.max(0, prevYear.auditRisk - 5);
            }

            // Minor long-term impact due to investor trust issues
            newYear.marketShare = 100 - year * (totalAdjustment() / 100);
            newYear.innovationIndex = 100;
            newYear.employeeMorale = 100 - (year * totalAdjustment()) / 200;
          }

          // Calculate profit for the year
          newYear.profit = calculateProfit(newYear);

          // Cap certain metrics to prevent unrealistic values
          newYear.marketShare = Math.max(40, newYear.marketShare);
          newYear.innovationIndex = Math.max(30, newYear.innovationIndex);
          newYear.employeeMorale = Math.max(50, newYear.employeeMorale);
          newYear.auditRisk = Math.min(100, newYear.auditRisk);

          simulationResults.push(newYear);
        }

        // Update charts and explanation
        updateCharts();
        updateExplanation();

        // Show results section
        resultsSection.classList.remove("hidden");
      }

      // Calculate total adjustment
      function totalAdjustment() {
        return (
          initialFinancials.researchAndDevelopment -
          financials.researchAndDevelopment +
          initialFinancials.salesAndMarketing -
          financials.salesAndMarketing +
          initialFinancials.generalAndAdmin -
          financials.generalAndAdmin
        );
      }

      // Update charts based on simulation results
      function updateCharts() {
        // Skip if no results
        if (simulationResults.length === 0) return;

        // Clear chart areas
        document.getElementById("profit-chart-area").innerHTML = "";
        document.getElementById("metrics-chart-area").innerHTML = "";
        document.getElementById("profit-y-axis").innerHTML = "";
        document.getElementById("profit-x-axis").innerHTML = "";
        document.getElementById("metrics-y-axis").innerHTML = "";
        document.getElementById("metrics-x-axis").innerHTML = "";

        // Profit chart
        const profitValues = simulationResults.map((year) => year.profit);
        const minProfit = Math.min(0, ...profitValues);
        const maxProfit = Math.max(...profitValues);
        const profitRange = maxProfit - minProfit;

        // Add y-axis labels for profit
        const profitYAxis = document.getElementById("profit-y-axis");
        for (let i = 0; i <= 4; i++) {
          const value = maxProfit - (i * profitRange) / 4;
          const label = document.createElement("span");
          label.textContent = `${Math.round(value)}`;
          profitYAxis.appendChild(label);
        }

        // Add x-axis labels for profit
        const profitXAxis = document.getElementById("profit-x-axis");
        for (let year = 0; year <= simulationYears; year++) {
          const label = document.createElement("span");
          label.textContent = year;
          profitXAxis.appendChild(label);
        }

        // Draw profit line
        const profitArea = document.getElementById("profit-chart-area");

        // Add zero line
        const zeroY = profitChartY(0);
        const zeroLine = document.createElement("div");
        zeroLine.className = "chart-zero-line";
        zeroLine.style.top = `${zeroY}px`;
        profitArea.appendChild(zeroLine);

        // Draw profit line and points
        for (let i = 0; i < simulationResults.length; i++) {
          const year = simulationResults[i];
          const x = profitChartX(year.year);
          const y = profitChartY(year.profit);

          // Create point
          const point = document.createElement("div");
          point.className = "chart-point";
          point.style.left = `${x}px`;
          point.style.top = `${y}px`;
          point.style.backgroundColor = "#3b82f6";
          point.title = `Year ${year.year}: ${formatCurrency(year.profit)}`;
          profitArea.appendChild(point);

          // Create line to next point if not last point
          if (i < simulationResults.length - 1) {
            const nextYear = simulationResults[i + 1];
            const nextX = profitChartX(nextYear.year);
            const nextY = profitChartY(nextYear.profit);

            // Create SVG line
            const svg = document.createElementNS(
              "http://www.w3.org/2000/svg",
              "svg"
            );
            svg.setAttribute("width", "100%");
            svg.setAttribute("height", "100%");
            svg.style.position = "absolute";
            svg.style.top = "0";
            svg.style.left = "0";
            svg.style.pointerEvents = "none";

            const line = document.createElementNS(
              "http://www.w3.org/2000/svg",
              "line"
            );
            line.setAttribute("x1", x);
            line.setAttribute("y1", y);
            line.setAttribute("x2", nextX);
            line.setAttribute("y2", nextY);
            line.setAttribute("stroke", "#3b82f6");
            line.setAttribute("stroke-width", "2");

            svg.appendChild(line);
            profitArea.appendChild(svg);
          }
        }

        // Metrics chart
        const metricsArea = document.getElementById("metrics-chart-area");

        // Add y-axis labels for metrics (0-100)
        const metricsYAxis = document.getElementById("metrics-y-axis");
        for (let i = 0; i <= 4; i++) {
          const value = 100 - i * 25;
          const label = document.createElement("span");
          label.textContent = value;
          metricsYAxis.appendChild(label);
        }

        // Add x-axis labels for metrics
        const metricsXAxis = document.getElementById("metrics-x-axis");
        for (let year = 0; year <= simulationYears; year++) {
          const label = document.createElement("span");
          label.textContent = year;
          metricsXAxis.appendChild(label);
        }

        // Draw metric lines
        const metrics = [
          { key: "marketShare", color: "#4ade80" },
          { key: "innovationIndex", color: "#8b5cf6" },
          { key: "employeeMorale", color: "#f59e0b" },
          { key: "auditRisk", color: "#ef4444" },
        ];

        metrics.forEach((metric) => {
          for (let i = 0; i < simulationResults.length; i++) {
            const year = simulationResults[i];
            const x = metricsChartX(year.year);
            const y = metricsChartY(year[metric.key]);

            // Create point
            const point = document.createElement("div");
            point.className = "chart-point";
            point.style.left = `${x}px`;
            point.style.top = `${y}px`;
            point.style.backgroundColor = metric.color;
            point.title = `Year ${year.year}: ${Math.round(year[metric.key])}`;
            metricsArea.appendChild(point);

            // Create line to next point if not last point
            if (i < simulationResults.length - 1) {
              const nextYear = simulationResults[i + 1];
              const nextX = metricsChartX(nextYear.year);
              const nextY = metricsChartY(nextYear[metric.key]);

              // Create SVG line
              const svg = document.createElementNS(
                "http://www.w3.org/2000/svg",
                "svg"
              );
              svg.setAttribute("width", "100%");
              svg.setAttribute("height", "100%");
              svg.style.position = "absolute";
              svg.style.top = "0";
              svg.style.left = "0";
              svg.style.pointerEvents = "none";

              const line = document.createElementNS(
                "http://www.w3.org/2000/svg",
                "line"
              );
              line.setAttribute("x1", x);
              line.setAttribute("y1", y);
              line.setAttribute("x2", nextX);
              line.setAttribute("y2", nextY);
              line.setAttribute("stroke", metric.color);
              line.setAttribute("stroke-width", "2");

              svg.appendChild(line);
              metricsArea.appendChild(svg);
            }
          }
        });
      }

      // Helper functions for chart coordinates
      function profitChartX(year) {
        const chartArea = document.getElementById("profit-chart-area");
        const width = chartArea.offsetWidth;
        return (year / simulationYears) * width;
      }

      function profitChartY(profit) {
        const chartArea = document.getElementById("profit-chart-area");
        const height = chartArea.offsetHeight;
        const profitValues = simulationResults.map((year) => year.profit);
        const minProfit = Math.min(0, ...profitValues);
        const maxProfit = Math.max(...profitValues);
        const range = maxProfit - minProfit;

        return height - ((profit - minProfit) / range) * height;
      }

      function metricsChartX(year) {
        const chartArea = document.getElementById("metrics-chart-area");
        const width = chartArea.offsetWidth;
        return (year / simulationYears) * width;
      }

      function metricsChartY(value) {
        const chartArea = document.getElementById("metrics-chart-area");
        const height = chartArea.offsetHeight;
        return height - (value / 100) * height;
      }

      // Update explanation text based on simulation results
      function updateExplanation() {
        const rdReduction =
          initialFinancials.researchAndDevelopment -
          financials.researchAndDevelopment;
        const smReduction =
          initialFinancials.salesAndMarketing - financials.salesAndMarketing;
        const gaReduction =
          initialFinancials.generalAndAdmin - financials.generalAndAdmin;

        if (managementStrategy === "real") {
          let explanation = "Real Earnings Management Consequences:\n\n";
          if (rdReduction > 0) {
            explanation += `• R&D reduction of €${rdReduction}M hurts innovation, slowing future growth. R&D investments typically yield returns 3-7 years after spending.\n\n`;
          }
          if (smReduction > 0) {
            explanation += `• Sales & Marketing reduction of €${smReduction}M reduces market visibility and customer acquisition, directly impacting market share.\n\n`;
          }
          if (gaReduction > 0) {
            explanation += `• General & Administrative cuts of €${gaReduction}M may reduce operational efficiency and lead to employee dissatisfaction, increasing operational costs over time.\n\n`;
          }
          explanation +=
            "While real earnings management strategies help achieve immediate targets, they often create permanent damage to the company's long-term competitive position.";
          explanationText.textContent = explanation;
        } else {
          let explanation = "Accrual Earnings Management Consequences:\n\n";
          explanation += `• Your adjustments totaling €${totalAdjustment()}M helped meet the immediate target but will likely reverse in following periods.\n\n`;
          explanation += `• Audit risk has increased proportionally with the magnitude of the adjustments.\n\n`;
          explanation += `• While operational metrics are less affected than with real earnings management, investor trust may be impacted if patterns of accrual management are detected.\n\n`;
          explanation +=
            "Accrual-based earnings management tends to 'borrow' profits from future periods, creating pressure to maintain or increase the magnitude of adjustments over time.";
          explanationText.textContent = explanation;
        }
      }

      // Reset the simulator
      function resetSimulator() {
        // Reset financials
        financials = { ...initialFinancials };
        rdInput.value = initialFinancials.researchAndDevelopment;
        smInput.value = initialFinancials.salesAndMarketing;
        gaInput.value = initialFinancials.generalAndAdmin;

        // Reset simulation results
        simulationResults = [];

        // Update UI
        updateUI();

        // Hide results section
        resultsSection.classList.add("hidden");
      }

      // Event listeners
      rdInput.addEventListener("input", function () {
        financials.researchAndDevelopment = parseFloat(this.value) || 0;
        updateUI();
      });

      smInput.addEventListener("input", function () {
        financials.salesAndMarketing = parseFloat(this.value) || 0;
        updateUI();
      });

      gaInput.addEventListener("input", function () {
        financials.generalAndAdmin = parseFloat(this.value) || 0;
        updateUI();
      });

      accrualRadio.addEventListener("change", function () {
        managementStrategy = "accrual";
        updateStrategyExplanation();
      });

      realRadio.addEventListener("change", function () {
        managementStrategy = "real";
        updateStrategyExplanation();
      });

      yearsSlider.addEventListener("input", function () {
        simulationYears = parseInt(this.value);
        yearsValue.textContent = simulationYears;
      });

      runBtn.addEventListener("click", runSimulation);

      resetBtn.addEventListener("click", resetSimulator);

      // Initialize UI
      updateUI();
      updateStrategyExplanation();
    </script>
  </body>
</html>
