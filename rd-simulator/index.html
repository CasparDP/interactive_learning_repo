<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>R&D Accounting Simulator - Incremental Loading</title>

    <!-- Tailwind CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css"
      rel="stylesheet"
    />

    <!-- Libraries - using the same CDNs that worked in the test page -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/17.0.2/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/17.0.2/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prop-types/15.8.1/prop-types.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/recharts/2.5.0/Recharts.min.js"></script>
  </head>
  <body class="bg-gray-100">
    <nav class="bg-blue-800 text-white p-4">
      <div class="container mx-auto">
        <div class="flex justify-between items-center">
          <h1 class="text-xl font-bold">Financial Reporting & Analysis</h1>
          <a href="../" class="hover:underline">‚Üê Back to Components</a>
        </div>
      </div>
    </nav>

    <main>
      <div id="root" class="container mx-auto py-6">
        <!-- Content will be dynamically generated -->
        <div class="flex justify-center items-center h-32">
          <div
            class="animate-spin rounded-full h-12 w-12 border-t-4 border-b-4 border-blue-500"
          ></div>
          <p id="loading-status" class="ml-3">Loading simulator...</p>
        </div>
      </div>
    </main>

    <div
      id="debug-output"
      class="container mx-auto mt-8 p-4 bg-gray-200 rounded-lg hidden"
    >
      <h2 class="text-lg font-bold mb-4">Debug Information</h2>
      <pre
        id="debug-content"
        class="bg-white p-4 rounded overflow-auto max-h-64"
      ></pre>
      <button
        id="toggle-debug"
        class="mt-4 px-4 py-2 bg-blue-500 text-white rounded"
      >
        Hide Debug Info
      </button>
    </div>

    <script>
      // Debug utility
      const debug = {
        log: function (message, data = null) {
          const timestamp = new Date().toISOString().substring(11, 19);
          const msg = data
            ? `[${timestamp}] ${message}: ${JSON.stringify(data)}`
            : `[${timestamp}] ${message}`;
          console.log(msg);

          const debugContent = document.getElementById("debug-content");
          if (debugContent) {
            debugContent.textContent += msg + "\n";
            document.getElementById("debug-output").classList.remove("hidden");
          }

          // Also update loading status
          const loadingStatus = document.getElementById("loading-status");
          if (loadingStatus) {
            loadingStatus.textContent = message;
          }
        },
        error: function (message, error) {
          const timestamp = new Date().toISOString().substring(11, 19);
          const errorDetails = error
            ? error.stack || error.message || String(error)
            : "";
          const msg = `[${timestamp}] ERROR: ${message}\n${errorDetails}`;
          console.error(msg);

          const debugContent = document.getElementById("debug-content");
          if (debugContent) {
            debugContent.textContent += msg + "\n";
            document.getElementById("debug-output").classList.remove("hidden");
          }

          // Update loading status to show error
          const loadingStatus = document.getElementById("loading-status");
          if (loadingStatus) {
            loadingStatus.textContent = `Error: ${message}`;
            loadingStatus.classList.add("text-red-600", "font-bold");
          }
        },
      };

      // Toggle debug panel
      document
        .getElementById("toggle-debug")
        .addEventListener("click", function () {
          const debugOutput = document.getElementById("debug-output");
          if (debugOutput.classList.contains("hidden")) {
            debugOutput.classList.remove("hidden");
            this.textContent = "Hide Debug Info";
          } else {
            debugOutput.classList.add("hidden");
            this.textContent = "Show Debug Info";
          }
        });

      // Main script - using window onload to ensure all resources are loaded
      window.onload = function () {
        try {
          debug.log("Window loaded, checking libraries");

          // Check that required libraries are available
          if (!window.React) throw new Error("React library not loaded");
          if (!window.ReactDOM) throw new Error("ReactDOM library not loaded");
          if (!window.Recharts) throw new Error("Recharts library not loaded");

          debug.log("All libraries loaded successfully");

          // Extract React hooks and components
          const { useState, useEffect } = React;
          const {
            LineChart,
            Line,
            XAxis,
            YAxis,
            CartesianGrid,
            Tooltip,
            Legend,
            ResponsiveContainer,
          } = Recharts;

          debug.log("Starting with basic React component");

          // Phase 1: Basic Component to test rendering
          const BasicComponent = () => {
            return React.createElement(
              "div",
              { className: "bg-blue-50 p-4 rounded-lg mb-6" },
              [
                React.createElement(
                  "h1",
                  {
                    className: "text-xl font-bold mb-4",
                    key: "title",
                  },
                  "R&D Accounting Treatment Simulator"
                ),

                React.createElement(
                  "p",
                  {
                    className: "mb-2",
                    key: "description",
                  },
                  "Basic component rendered successfully. Phase 1 complete."
                ),
              ]
            );
          };

          try {
            debug.log("Rendering basic component");
            ReactDOM.render(
              React.createElement(BasicComponent),
              document.getElementById("root")
            );
            debug.log("Basic component rendered successfully");

            // If basic component renders, move to Phase 2 after a short delay
            setTimeout(() => {
              try {
                debug.log("Starting Phase 2: Simple Form Component");

                // Phase 2: Simple Form Component
                const SimpleFormComponent = () => {
                  const [value, setValue] = useState(500);

                  return React.createElement(
                    "div",
                    { className: "bg-blue-50 p-4 rounded-lg mb-6" },
                    [
                      React.createElement(
                        "h1",
                        {
                          className: "text-xl font-bold mb-4",
                          key: "title",
                        },
                        "R&D Accounting Simulator - Phase 2"
                      ),

                      React.createElement(
                        "div",
                        {
                          className: "mb-4",
                          key: "form-group",
                        },
                        [
                          React.createElement(
                            "label",
                            {
                              className:
                                "block text-sm font-medium text-gray-700 mb-1",
                              key: "label",
                            },
                            "Initial Cash"
                          ),

                          React.createElement("input", {
                            type: "number",
                            value: value,
                            onChange: (e) =>
                              setValue(parseFloat(e.target.value)),
                            className:
                              "mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border",
                            key: "input",
                          }),
                        ]
                      ),

                      React.createElement(
                        "p",
                        {
                          className: "mt-2",
                          key: "output",
                        },
                        `Current value: ${value}`
                      ),

                      React.createElement(
                        "button",
                        {
                          className:
                            "mt-4 px-4 py-2 bg-blue-500 text-white rounded",
                          onClick: () => setValue(500),
                          key: "reset-button",
                        },
                        "Reset Value"
                      ),
                    ]
                  );
                };

                ReactDOM.render(
                  React.createElement(SimpleFormComponent),
                  document.getElementById("root")
                );
                debug.log(
                  "Phase 2 completed: Form component with React hooks rendered successfully"
                );

                // If form component renders, move to Phase 3 after a short delay
                setTimeout(() => {
                  try {
                    debug.log("Starting Phase 3: Simple Chart Component");

                    // Phase 3: Simple Chart Component
                    const SimpleChartComponent = () => {
                      // Simple data for the chart
                      const data = [
                        { name: "Year 1", Value: 100 },
                        { name: "Year 2", Value: 200 },
                        { name: "Year 3", Value: 150 },
                        { name: "Year 4", Value: 300 },
                        { name: "Year 5", Value: 250 },
                      ];

                      return React.createElement(
                        "div",
                        { className: "bg-blue-50 p-4 rounded-lg mb-6" },
                        [
                          React.createElement(
                            "h1",
                            {
                              className: "text-xl font-bold mb-4",
                              key: "title",
                            },
                            "R&D Accounting Simulator - Phase 3"
                          ),

                          React.createElement(
                            "p",
                            {
                              className: "mb-4",
                              key: "description",
                            },
                            "Testing Recharts Component:"
                          ),

                          React.createElement(
                            "div",
                            {
                              className: "h-64 w-full",
                              key: "chart-container",
                            },
                            React.createElement(
                              ResponsiveContainer,
                              {
                                width: "100%",
                                height: "100%",
                              },
                              React.createElement(
                                LineChart,
                                {
                                  data: data,
                                },
                                [
                                  React.createElement(CartesianGrid, {
                                    strokeDasharray: "3 3",
                                    key: "grid",
                                  }),
                                  React.createElement(XAxis, {
                                    dataKey: "name",
                                    key: "xaxis",
                                  }),
                                  React.createElement(YAxis, {
                                    key: "yaxis",
                                  }),
                                  React.createElement(Tooltip, {
                                    key: "tooltip",
                                  }),
                                  React.createElement(Legend, {
                                    key: "legend",
                                  }),
                                  React.createElement(Line, {
                                    type: "monotone",
                                    dataKey: "Value",
                                    stroke: "#8884d8",
                                    key: "line",
                                  }),
                                ]
                              )
                            )
                          ),
                        ]
                      );
                    };

                    ReactDOM.render(
                      React.createElement(SimpleChartComponent),
                      document.getElementById("root")
                    );
                    debug.log(
                      "Phase 3 completed: Chart component rendered successfully"
                    );

                    // If chart component renders, we can proceed to the final phase - the actual simulator
                    setTimeout(() => {
                      try {
                        debug.log(
                          "Starting Phase 4: Full R&D Simulator Component"
                        );

                        // Phase 4: Full Simulator - loading from separate function for clarity
                        loadFullSimulator();
                      } catch (error) {
                        debug.error("Error in Phase 4 initialization", error);
                      }
                    }, 1000);
                  } catch (error) {
                    debug.error("Error in Phase 3: Chart component", error);
                  }
                }, 1000);
              } catch (error) {
                debug.error("Error in Phase 2: Form component", error);
              }
            }, 1000);
          } catch (error) {
            debug.error("Error rendering basic component", error);
          }
        } catch (error) {
          debug.error("Initialization error", error);
        }
      };

      // Load the full simulator - separated for clarity
      function loadFullSimulator() {
        const { useState, useEffect } = React;
        const {
          LineChart,
          Line,
          XAxis,
          YAxis,
          CartesianGrid,
          Tooltip,
          Legend,
          ResponsiveContainer,
        } = Recharts;

        debug.log("Creating RDAccountingSimulator component");

        // The actual RDAccountingSimulator component
        const RDAccountingSimulator = () => {
          debug.log("Initializing simulator component state");

          // Default values for our simulation
          const defaultValues = {
            initialCash: 500,
            otherAssets: 500,
            debt: 700,
            equity: 300,
            researchExpense: 150,
            developmentExpense: 100,
            revenue: 200,
            amortizationRate: 25,
            simulationYears: 5,
          };

          // State for user inputs
          const [inputs, setInputs] = useState(defaultValues);

          debug.log("State initialized with default values");

          // State for simulation results
          const [simulationResults, setSimulationResults] = useState({
            expenseAll: [],
            capitalizeDevelopment: [],
          });

          // State for financial ratios
          const [ratios, setRatios] = useState({
            expenseAll: { roe: [], assetTurnover: [] },
            capitalizeDevelopment: { roe: [], assetTurnover: [] },
          });

          // Handle input changes
          const handleInputChange = (e) => {
            const { name, value } = e.target;
            setInputs((prev) => ({
              ...prev,
              [name]: parseFloat(value),
            }));
          };

          // Reset to default values
          const handleReset = () => {
            setInputs(defaultValues);
          };

          // Run simulation
          useEffect(() => {
            debug.log("Running simulation with inputs", inputs);
            runSimulation();
          }, [inputs]);

          const runSimulation = () => {
            try {
              // Simulate both accounting methods
              const expenseAllResults = simulateMethod("expenseAll");
              const capitalizeDevelopmentResults = simulateMethod(
                "capitalizeDevelopment"
              );

              setSimulationResults({
                expenseAll: expenseAllResults,
                capitalizeDevelopment: capitalizeDevelopmentResults,
              });

              // Calculate ratios for both methods
              const expenseAllRatios = calculateRatios(expenseAllResults);
              const capitalizeDevelopmentRatios = calculateRatios(
                capitalizeDevelopmentResults
              );

              setRatios({
                expenseAll: expenseAllRatios,
                capitalizeDevelopment: capitalizeDevelopmentRatios,
              });

              debug.log("Simulation completed successfully");
            } catch (error) {
              debug.error("Error in runSimulation", error);
            }
          };

          const simulateMethod = (method) => {
            const results = [];

            // Initial state
            let currentYear = {
              year: 0,
              cash: inputs.initialCash,
              otherAssets: inputs.otherAssets,
              intangibleAssets: 0,
              totalAssets: inputs.initialCash + inputs.otherAssets,
              debt: inputs.debt,
              equity: inputs.equity,
              revenue: 0,
              researchExpense: 0,
              developmentExpense: 0,
              amortizationExpense: 0,
              profit: 0,
              roe: 0,
              assetTurnover: 0,
            };

            results.push({ ...currentYear });

            // Simulate for each year
            for (let year = 1; year <= inputs.simulationYears; year++) {
              const prevYear = results[year - 1];

              // Create a deep copy for the current year
              const newYear = {
                year,
                cash: prevYear.cash,
                otherAssets: prevYear.otherAssets,
                intangibleAssets: prevYear.intangibleAssets,
                debt: prevYear.debt,
                revenue: inputs.revenue,
                researchExpense: inputs.researchExpense,
                developmentExpense: inputs.developmentExpense,
              };

              // Cash outflows for R&D
              newYear.cash -=
                inputs.researchExpense + inputs.developmentExpense;

              // Cash inflows from revenue
              newYear.cash += inputs.revenue;

              // Treatment of R&D expenses differs by accounting method
              if (method === "expenseAll") {
                // Expense both research and development
                newYear.amortizationExpense = 0;
                newYear.profit =
                  newYear.revenue -
                  newYear.researchExpense -
                  newYear.developmentExpense;
              } else {
                // Capitalize development costs
                newYear.intangibleAssets =
                  prevYear.intangibleAssets + inputs.developmentExpense;

                // Amortize development costs
                newYear.amortizationExpense =
                  (newYear.intangibleAssets * inputs.amortizationRate) / 100;
                newYear.intangibleAssets -= newYear.amortizationExpense;

                // Only research is expensed immediately
                newYear.profit =
                  newYear.revenue -
                  newYear.researchExpense -
                  newYear.amortizationExpense;
              }

              // Update equity based on profit
              newYear.equity = prevYear.equity + newYear.profit;

              // Calculate total assets
              newYear.totalAssets =
                newYear.cash + newYear.otherAssets + newYear.intangibleAssets;

              // Calculate financial ratios
              newYear.roe = (newYear.profit / prevYear.equity) * 100; // ROE as percentage
              newYear.assetTurnover = newYear.revenue / prevYear.totalAssets;

              results.push(newYear);
            }

            return results;
          };

          const calculateRatios = (results) => {
            const roeValues = results.slice(1).map((year) => ({
              year: year.year,
              value: year.roe,
            }));

            const assetTurnoverValues = results.slice(1).map((year) => ({
              year: year.year,
              value: year.assetTurnover,
            }));

            return {
              roe: roeValues,
              assetTurnover: assetTurnoverValues,
            };
          };

          // Prepare chart data
          const prepareChartData = (metric) => {
            const data = [];

            for (let i = 0; i <= inputs.simulationYears; i++) {
              const expenseAllValue = simulationResults.expenseAll[i]
                ? simulationResults.expenseAll[i][metric]
                : 0;
              const capitalizeDevelopmentValue = simulationResults
                .capitalizeDevelopment[i]
                ? simulationResults.capitalizeDevelopment[i][metric]
                : 0;

              data.push({
                year: i,
                "Expense All R&D": expenseAllValue,
                "Capitalize Development": capitalizeDevelopmentValue,
              });
            }

            return data;
          };

          // Format currency values
          const formatCurrency = (value) => {
            return new Intl.NumberFormat("en-US", {
              style: "currency",
              currency: "EUR",
              minimumFractionDigits: 0,
              maximumFractionDigits: 0,
            }).format(value);
          };

          // Prepare data for comparison tables
          const prepareTableData = () => {
            if (
              simulationResults.expenseAll.length === 0 ||
              simulationResults.capitalizeDevelopment.length === 0
            ) {
              return [];
            }

            return simulationResults.expenseAll.map((yearData, index) => {
              const capDevYearData =
                simulationResults.capitalizeDevelopment[index];
              return {
                year: yearData.year,
                profit: {
                  expenseAll: yearData.profit,
                  capitalizeDevelopment: capDevYearData.profit,
                  difference: capDevYearData.profit - yearData.profit,
                },
                equity: {
                  expenseAll: yearData.equity,
                  capitalizeDevelopment: capDevYearData.equity,
                  difference: capDevYearData.equity - yearData.equity,
                },
                totalAssets: {
                  expenseAll: yearData.totalAssets,
                  capitalizeDevelopment: capDevYearData.totalAssets,
                  difference: capDevYearData.totalAssets - yearData.totalAssets,
                },
              };
            });
          };

          const tableData = prepareTableData();

          // Ratio comparison data for the selected year
          const selectedYear = Math.min(
            inputs.simulationYears,
            Math.max(1, inputs.simulationYears)
          );
          const yearRatioData = {
            roe: {
              expenseAll:
                ratios.expenseAll.roe.find((r) => r.year === selectedYear)
                  ?.value || 0,
              capitalizeDevelopment:
                ratios.capitalizeDevelopment.roe.find(
                  (r) => r.year === selectedYear
                )?.value || 0,
            },
            assetTurnover: {
              expenseAll:
                ratios.expenseAll.assetTurnover.find(
                  (r) => r.year === selectedYear
                )?.value || 0,
              capitalizeDevelopment:
                ratios.capitalizeDevelopment.assetTurnover.find(
                  (r) => r.year === selectedYear
                )?.value || 0,
            },
          };

          debug.log("Rendering simulator component UI");

          // Now that all calculations are done, render the component
          return React.createElement(
            "div",
            { className: "flex flex-col w-full" },
            [
              // Header section
              React.createElement(
                "div",
                { className: "bg-blue-50 p-4 rounded-lg mb-6", key: "header" },
                [
                  React.createElement(
                    "h1",
                    { className: "text-xl font-bold mb-4", key: "title" },
                    "R&D Accounting Treatment Simulator"
                  ),
                  React.createElement(
                    "p",
                    { className: "mb-2", key: "description" },
                    "This simulator demonstrates how different accounting treatments for R&D expenditures affect financial statements and key ratios over time."
                  ),
                  React.createElement(
                    "ul",
                    { className: "list-disc ml-6 mb-2", key: "list" },
                    [
                      React.createElement("li", { key: "item1" }, [
                        React.createElement(
                          "strong",
                          { key: "strong1" },
                          "Expense All R&D:"
                        ),
                        " Both research and development costs are immediately expensed",
                      ]),
                      React.createElement("li", { key: "item2" }, [
                        React.createElement(
                          "strong",
                          { key: "strong2" },
                          "Capitalize Development:"
                        ),
                        " Research costs are expensed, but development costs are capitalized and amortized",
                      ]),
                    ]
                  ),
                ]
              ),

              // Main content section - inputs and results
              React.createElement(
                "div",
                { className: "flex flex-wrap mb-8", key: "main-content" },
                [
                  // Parameters section
                  React.createElement(
                    "div",
                    { className: "w-full md:w-1/2 p-4", key: "parameters" },
                    [
                      React.createElement(
                        "h2",
                        {
                          className: "text-lg font-bold mb-4",
                          key: "params-title",
                        },
                        "Simulation Parameters"
                      ),

                      // Grid of input fields
                      React.createElement(
                        "div",
                        {
                          className: "grid grid-cols-2 gap-4",
                          key: "input-grid",
                        },
                        [
                          // Initial Cash
                          React.createElement(
                            "div",
                            { key: "initial-cash-group" },
                            [
                              React.createElement(
                                "label",
                                {
                                  className:
                                    "block text-sm font-medium text-gray-700",
                                  key: "initial-cash-label",
                                },
                                "Initial Cash"
                              ),
                              React.createElement("input", {
                                type: "number",
                                name: "initialCash",
                                value: inputs.initialCash,
                                onChange: handleInputChange,
                                className:
                                  "mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border",
                                key: "initial-cash-input",
                              }),
                            ]
                          ),

                          // Other Assets
                          React.createElement(
                            "div",
                            { key: "other-assets-group" },
                            [
                              React.createElement(
                                "label",
                                {
                                  className:
                                    "block text-sm font-medium text-gray-700",
                                  key: "other-assets-label",
                                },
                                "Other Assets"
                              ),
                              React.createElement("input", {
                                type: "number",
                                name: "otherAssets",
                                value: inputs.otherAssets,
                                onChange: handleInputChange,
                                className:
                                  "mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border",
                                key: "other-assets-input",
                              }),
                            ]
                          ),

                          // Debt
                          React.createElement("div", { key: "debt-group" }, [
                            React.createElement(
                              "label",
                              {
                                className:
                                  "block text-sm font-medium text-gray-700",
                                key: "debt-label",
                              },
                              "Initial Debt"
                            ),
                            React.createElement("input", {
                              type: "number",
                              name: "debt",
                              value: inputs.debt,
                              onChange: handleInputChange,
                              className:
                                "mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border",
                              key: "debt-input",
                            }),
                          ]),

                          // Equity
                          React.createElement("div", { key: "equity-group" }, [
                            React.createElement(
                              "label",
                              {
                                className:
                                  "block text-sm font-medium text-gray-700",
                                key: "equity-label",
                              },
                              "Initial Equity"
                            ),
                            React.createElement("input", {
                              type: "number",
                              name: "equity",
                              value: inputs.equity,
                              onChange: handleInputChange,
                              className:
                                "mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border",
                              key: "equity-input",
                            }),
                          ]),

                          // Revenue
                          React.createElement("div", { key: "revenue-group" }, [
                            React.createElement(
                              "label",
                              {
                                className:
                                  "block text-sm font-medium text-gray-700",
                                key: "revenue-label",
                              },
                              "Annual Revenue"
                            ),
                            React.createElement("input", {
                              type: "number",
                              name: "revenue",
                              value: inputs.revenue,
                              onChange: handleInputChange,
                              className:
                                "mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border",
                              key: "revenue-input",
                            }),
                          ]),

                          // Research Expense
                          React.createElement(
                            "div",
                            { key: "research-expense-group" },
                            [
                              React.createElement(
                                "label",
                                {
                                  className:
                                    "block text-sm font-medium text-gray-700",
                                  key: "research-expense-label",
                                },
                                "Annual Research Expense"
                              ),
                              React.createElement("input", {
                                type: "number",
                                name: "researchExpense",
                                value: inputs.researchExpense,
                                onChange: handleInputChange,
                                className:
                                  "mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border",
                                key: "research-expense-input",
                              }),
                            ]
                          ),

                          // Development Expense
                          React.createElement(
                            "div",
                            { key: "development-expense-group" },
                            [
                              React.createElement(
                                "label",
                                {
                                  className:
                                    "block text-sm font-medium text-gray-700",
                                  key: "development-expense-label",
                                },
                                "Annual Development Expense"
                              ),
                              React.createElement("input", {
                                type: "number",
                                name: "developmentExpense",
                                value: inputs.developmentExpense,
                                onChange: handleInputChange,
                                className:
                                  "mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border",
                                key: "development-expense-input",
                              }),
                            ]
                          ),

                          // Amortization Rate
                          React.createElement(
                            "div",
                            { key: "amortization-rate-group" },
                            [
                              React.createElement(
                                "label",
                                {
                                  className:
                                    "block text-sm font-medium text-gray-700",
                                  key: "amortization-rate-label",
                                },
                                "Amortization Rate (% per year)"
                              ),
                              React.createElement("input", {
                                type: "number",
                                name: "amortizationRate",
                                value: inputs.amortizationRate,
                                onChange: handleInputChange,
                                className:
                                  "mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border",
                                key: "amortization-rate-input",
                              }),
                            ]
                          ),

                          // Simulation Years
                          React.createElement(
                            "div",
                            { key: "simulation-years-group" },
                            [
                              React.createElement(
                                "label",
                                {
                                  className:
                                    "block text-sm font-medium text-gray-700",
                                  key: "simulation-years-label",
                                },
                                "Simulation Years"
                              ),
                              React.createElement("input", {
                                type: "number",
                                name: "simulationYears",
                                value: inputs.simulationYears,
                                onChange: handleInputChange,
                                min: "1",
                                max: "10",
                                className:
                                  "mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border",
                                key: "simulation-years-input",
                              }),
                            ]
                          ),

                          // Reset button
                          React.createElement(
                            "div",
                            {
                              className: "col-span-2",
                              key: "reset-button-group",
                            },
                            React.createElement(
                              "button",
                              {
                                onClick: handleReset,
                                className:
                                  "w-full px-4 py-2 bg-gray-300 text-gray-800 rounded hover:bg-gray-400",
                                key: "reset-button",
                              },
                              "Reset to Defaults"
                            )
                          ),
                        ]
                      ),
                    ]
                  ),

                  // Results section
                  React.createElement(
                    "div",
                    { className: "w-full md:w-1/2 p-4", key: "results" },
                    [
                      React.createElement(
                        "h2",
                        {
                          className: "text-lg font-bold mb-4",
                          key: "results-title",
                        },
                        "Financial Statement Impact"
                      ),

                      // Table
                      React.createElement(
                        "div",
                        {
                          className: "overflow-x-auto",
                          key: "table-container",
                        },
                        React.createElement(
                          "table",
                          {
                            className: "min-w-full border-collapse",
                            key: "table",
                          },
                          [
                            // Table header
                            React.createElement("thead", { key: "thead" }, [
                              React.createElement(
                                "tr",
                                {
                                  className: "bg-gray-200",
                                  key: "header-row-1",
                                },
                                [
                                  React.createElement(
                                    "th",
                                    {
                                      className: "border px-2 py-1 text-sm",
                                      key: "year-header",
                                    },
                                    "Year"
                                  ),
                                  React.createElement(
                                    "th",
                                    {
                                      className: "border px-2 py-1 text-sm",
                                      colSpan: 3,
                                      key: "profit-header",
                                    },
                                    "Profit"
                                  ),
                                  React.createElement(
                                    "th",
                                    {
                                      className: "border px-2 py-1 text-sm",
                                      colSpan: 3,
                                      key: "equity-header",
                                    },
                                    "Equity"
                                  ),
                                ]
                              ),
                              React.createElement(
                                "tr",
                                {
                                  className: "bg-gray-100",
                                  key: "header-row-2",
                                },
                                [
                                  React.createElement("th", {
                                    className: "border px-2 py-1 text-sm",
                                    key: "empty-header",
                                  }),
                                  React.createElement(
                                    "th",
                                    {
                                      className: "border px-2 py-1 text-sm",
                                      key: "expense-all-profit-header",
                                    },
                                    "Expense All"
                                  ),
                                  React.createElement(
                                    "th",
                                    {
                                      className: "border px-2 py-1 text-sm",
                                      key: "capitalize-dev-profit-header",
                                    },
                                    "Capitalize Dev"
                                  ),
                                  React.createElement(
                                    "th",
                                    {
                                      className: "border px-2 py-1 text-sm",
                                      key: "diff-profit-header",
                                    },
                                    "Diff"
                                  ),
                                  React.createElement(
                                    "th",
                                    {
                                      className: "border px-2 py-1 text-sm",
                                      key: "expense-all-equity-header",
                                    },
                                    "Expense All"
                                  ),
                                  React.createElement(
                                    "th",
                                    {
                                      className: "border px-2 py-1 text-sm",
                                      key: "capitalize-dev-equity-header",
                                    },
                                    "Capitalize Dev"
                                  ),
                                  React.createElement(
                                    "th",
                                    {
                                      className: "border px-2 py-1 text-sm",
                                      key: "diff-equity-header",
                                    },
                                    "Diff"
                                  ),
                                ]
                              ),
                            ]),

                            // Table body
                            React.createElement(
                              "tbody",
                              { key: "tbody" },
                              tableData.map((yearData) =>
                                React.createElement(
                                  "tr",
                                  {
                                    key: `year-${yearData.year}`,
                                    className:
                                      yearData.year % 2 === 0
                                        ? "bg-gray-50"
                                        : "bg-white",
                                  },
                                  [
                                    // Year
                                    React.createElement(
                                      "td",
                                      {
                                        className:
                                          "border px-2 py-1 text-sm font-bold",
                                        key: "year",
                                      },
                                      yearData.year
                                    ),

                                    // Expense All Profit
                                    React.createElement(
                                      "td",
                                      {
                                        className:
                                          "border px-2 py-1 text-sm text-right",
                                        key: "expense-all-profit",
                                      },
                                      formatCurrency(yearData.profit.expenseAll)
                                    ),

                                    // Capitalize Dev Profit
                                    React.createElement(
                                      "td",
                                      {
                                        className:
                                          "border px-2 py-1 text-sm text-right",
                                        key: "capitalize-dev-profit",
                                      },
                                      formatCurrency(
                                        yearData.profit.capitalizeDevelopment
                                      )
                                    ),

                                    // Profit Difference
                                    React.createElement(
                                      "td",
                                      {
                                        className: `border px-2 py-1 text-sm text-right ${
                                          yearData.profit.difference > 0
                                            ? "text-green-600"
                                            : yearData.profit.difference < 0
                                            ? "text-red-600"
                                            : ""
                                        }`,
                                        key: "profit-diff",
                                      },
                                      formatCurrency(yearData.profit.difference)
                                    ),

                                    // Expense All Equity
                                    React.createElement(
                                      "td",
                                      {
                                        className:
                                          "border px-2 py-1 text-sm text-right",
                                        key: "expense-all-equity",
                                      },
                                      formatCurrency(yearData.equity.expenseAll)
                                    ),

                                    // Capitalize Dev Equity
                                    React.createElement(
                                      "td",
                                      {
                                        className:
                                          "border px-2 py-1 text-sm text-right",
                                        key: "capitalize-dev-equity",
                                      },
                                      formatCurrency(
                                        yearData.equity.capitalizeDevelopment
                                      )
                                    ),

                                    // Equity Difference
                                    React.createElement(
                                      "td",
                                      {
                                        className: `border px-2 py-1 text-sm text-right ${
                                          yearData.equity.difference > 0
                                            ? "text-green-600"
                                            : yearData.equity.difference < 0
                                            ? "text-red-600"
                                            : ""
                                        }`,
                                        key: "equity-diff",
                                      },
                                      formatCurrency(yearData.equity.difference)
                                    ),
                                  ]
                                )
                              )
                            ),
                          ]
                        )
                      ),

                      // Financial Ratios Comparison
                      React.createElement(
                        "h2",
                        {
                          className: "text-lg font-bold mt-6 mb-4",
                          key: "ratios-title",
                        },
                        `Financial Ratios Comparison (Year ${selectedYear})`
                      ),

                      React.createElement(
                        "div",
                        {
                          className: "grid grid-cols-2 gap-4",
                          key: "ratios-grid",
                        },
                        [
                          // ROE Card
                          React.createElement(
                            "div",
                            {
                              className: "bg-blue-50 p-4 rounded-lg",
                              key: "roe-card",
                            },
                            [
                              React.createElement(
                                "h3",
                                {
                                  className: "font-bold mb-2",
                                  key: "roe-title",
                                },
                                "Return on Equity (ROE)"
                              ),

                              React.createElement(
                                "div",
                                {
                                  className: "flex justify-between",
                                  key: "roe-values",
                                },
                                [
                                  React.createElement(
                                    "div",
                                    { key: "roe-expense-all" },
                                    [
                                      React.createElement(
                                        "p",
                                        {
                                          className: "text-sm",
                                          key: "roe-expense-all-label",
                                        },
                                        "Expense All:"
                                      ),
                                      React.createElement(
                                        "p",
                                        {
                                          className: "text-lg font-bold",
                                          key: "roe-expense-all-value",
                                        },
                                        `${yearRatioData.roe.expenseAll.toFixed(
                                          2
                                        )}%`
                                      ),
                                    ]
                                  ),

                                  React.createElement(
                                    "div",
                                    { key: "roe-capitalize-dev" },
                                    [
                                      React.createElement(
                                        "p",
                                        {
                                          className: "text-sm",
                                          key: "roe-capitalize-dev-label",
                                        },
                                        "Capitalize Development:"
                                      ),
                                      React.createElement(
                                        "p",
                                        {
                                          className: "text-lg font-bold",
                                          key: "roe-capitalize-dev-value",
                                        },
                                        `${yearRatioData.roe.capitalizeDevelopment.toFixed(
                                          2
                                        )}%`
                                      ),
                                    ]
                                  ),
                                ]
                              ),

                              React.createElement(
                                "p",
                                {
                                  className: `text-sm mt-2 ${
                                    yearRatioData.roe.capitalizeDevelopment >
                                    yearRatioData.roe.expenseAll
                                      ? "text-green-600"
                                      : "text-red-600"
                                  }`,
                                  key: "roe-diff",
                                },
                                `Difference: ${(
                                  yearRatioData.roe.capitalizeDevelopment -
                                  yearRatioData.roe.expenseAll
                                ).toFixed(2)}%`
                              ),
                            ]
                          ),

                          // Asset Turnover Card
                          React.createElement(
                            "div",
                            {
                              className: "bg-blue-50 p-4 rounded-lg",
                              key: "asset-turnover-card",
                            },
                            [
                              React.createElement(
                                "h3",
                                {
                                  className: "font-bold mb-2",
                                  key: "asset-turnover-title",
                                },
                                "Asset Turnover"
                              ),

                              React.createElement(
                                "div",
                                {
                                  className: "flex justify-between",
                                  key: "asset-turnover-values",
                                },
                                [
                                  React.createElement(
                                    "div",
                                    { key: "asset-turnover-expense-all" },
                                    [
                                      React.createElement(
                                        "p",
                                        {
                                          className: "text-sm",
                                          key: "asset-turnover-expense-all-label",
                                        },
                                        "Expense All:"
                                      ),
                                      React.createElement(
                                        "p",
                                        {
                                          className: "text-lg font-bold",
                                          key: "asset-turnover-expense-all-value",
                                        },
                                        yearRatioData.assetTurnover.expenseAll.toFixed(
                                          2
                                        )
                                      ),
                                    ]
                                  ),

                                  React.createElement(
                                    "div",
                                    { key: "asset-turnover-capitalize-dev" },
                                    [
                                      React.createElement(
                                        "p",
                                        {
                                          className: "text-sm",
                                          key: "asset-turnover-capitalize-dev-label",
                                        },
                                        "Capitalize Development:"
                                      ),
                                      React.createElement(
                                        "p",
                                        {
                                          className: "text-lg font-bold",
                                          key: "asset-turnover-capitalize-dev-value",
                                        },
                                        yearRatioData.assetTurnover.capitalizeDevelopment.toFixed(
                                          2
                                        )
                                      ),
                                    ]
                                  ),
                                ]
                              ),

                              React.createElement(
                                "p",
                                {
                                  className: `text-sm mt-2 ${
                                    yearRatioData.assetTurnover
                                      .capitalizeDevelopment >
                                    yearRatioData.assetTurnover.expenseAll
                                      ? "text-green-600"
                                      : "text-red-600"
                                  }`,
                                  key: "asset-turnover-diff",
                                },
                                `Difference: ${(
                                  yearRatioData.assetTurnover
                                    .capitalizeDevelopment -
                                  yearRatioData.assetTurnover.expenseAll
                                ).toFixed(2)}`
                              ),
                            ]
                          ),
                        ]
                      ),
                    ]
                  ),
                ]
              ),

              // Profit Trends Chart
              React.createElement(
                "div",
                { className: "p-4", key: "profit-trends" },
                [
                  React.createElement(
                    "h2",
                    {
                      className: "text-lg font-bold mb-4",
                      key: "profit-trends-title",
                    },
                    "Profit Trends Over Time"
                  ),

                  React.createElement(
                    "div",
                    { className: "h-64", key: "profit-chart-container" },
                    React.createElement(
                      ResponsiveContainer,
                      {
                        width: "100%",
                        height: "100%",
                        key: "profit-responsive-container",
                      },
                      React.createElement(
                        LineChart,
                        {
                          data: prepareChartData("profit"),
                          margin: { top: 5, right: 30, left: 20, bottom: 5 },
                          key: "profit-line-chart",
                        },
                        [
                          React.createElement(CartesianGrid, {
                            strokeDasharray: "3 3",
                            key: "profit-grid",
                          }),
                          React.createElement(XAxis, {
                            dataKey: "year",
                            label: {
                              value: "Year",
                              position: "insideBottom",
                              offset: -5,
                            },
                            key: "profit-xaxis",
                          }),
                          React.createElement(YAxis, {
                            label: {
                              value: "Profit",
                              angle: -90,
                              position: "insideLeft",
                            },
                            key: "profit-yaxis",
                          }),
                          React.createElement(Tooltip, {
                            formatter: (value) => formatCurrency(value),
                            key: "profit-tooltip",
                          }),
                          React.createElement(Legend, {
                            key: "profit-legend",
                          }),
                          React.createElement(Line, {
                            type: "monotone",
                            dataKey: "Expense All R&D",
                            stroke: "#8884d8",
                            strokeWidth: 2,
                            key: "profit-line-expenseall",
                          }),
                          React.createElement(Line, {
                            type: "monotone",
                            dataKey: "Capitalize Development",
                            stroke: "#82ca9d",
                            strokeWidth: 2,
                            key: "profit-line-capitalizedev",
                          }),
                        ]
                      )
                    )
                  ),
                ]
              ),

              // Key Insights
              React.createElement(
                "div",
                {
                  className: "p-4 mt-4 bg-gray-100 rounded-lg",
                  key: "key-insights",
                },
                [
                  React.createElement(
                    "h2",
                    {
                      className: "text-lg font-bold mb-4",
                      key: "insights-title",
                    },
                    "Key Insights"
                  ),

                  React.createElement(
                    "div",
                    {
                      className: "grid grid-cols-1 md:grid-cols-2 gap-4",
                      key: "insights-grid",
                    },
                    [
                      // Short-term Impact
                      React.createElement(
                        "div",
                        {
                          className: "bg-white p-4 rounded-lg shadow",
                          key: "short-term-impact",
                        },
                        [
                          React.createElement(
                            "h3",
                            {
                              className: "font-bold text-blue-800 mb-2",
                              key: "short-term-title",
                            },
                            "Short-term Impact"
                          ),

                          React.createElement(
                            "p",
                            { key: "short-term-description" },
                            "Capitalizing development costs typically leads to higher reported profits in the early years compared to expensing all R&D costs. This is because development costs are spread over multiple periods rather than being expensed immediately."
                          ),
                        ]
                      ),

                      // Long-term Convergence
                      React.createElement(
                        "div",
                        {
                          className: "bg-white p-4 rounded-lg shadow",
                          key: "long-term-convergence",
                        },
                        [
                          React.createElement(
                            "h3",
                            {
                              className: "font-bold text-blue-800 mb-2",
                              key: "long-term-title",
                            },
                            "Long-term Convergence"
                          ),

                          React.createElement(
                            "p",
                            { key: "long-term-description" },
                            "Over time, the cumulative profit difference tends to diminish as amortization expenses catch up with the capitalized amounts. Total lifetime profits will be the same under both methods, but the timing of profit recognition differs."
                          ),
                        ]
                      ),
                    ]
                  ),
                ]
              ),
            ]
          );
        };

        // Render the component
        debug.log("Rendering RDAccountingSimulator component");
        try {
          ReactDOM.render(
            React.createElement(RDAccountingSimulator),
            document.getElementById("root")
          );
          debug.log("RDAccountingSimulator rendered successfully!");
        } catch (error) {
          debug.error("Error rendering RDAccountingSimulator", error);
        }
      }
    </script>
  </body>
</html>
